# ウェブ地図のレンダリングにおける宣言型と操作型

## 宣言型 (declarative)
DOMやSVGにあるようなもの。モデルを渡し、スタイルを設定し、
レンダリングを任せる。イベントハンドラを吊るすことができるので、
GIS的な世界観にはあう。

Leaflet, OpenLayers その他クラシックなウェブ地図APIは
オブジェクトをどんどん置いていってイベントハンドラを吊るす
デザインになっており、宣言型だなあと思う。

MVCにせよ何にせよ、ウェブの世界はかなり宣言型優位で進んできた
ところと感じる。WebGL/OpenGLが、命令型モデルでしか得られない
パフォーマンスをウェブ系に導入してきたところから、風向きが
変わってきている。

逆に言えば、例えば Leaflet は命令型の（高速さと引き換えの）
複雑さの導入を意図的に回避してきている気がする。

## 操作型（命令型 / imperative / operational）
CanvasやWebGLやPostScriptにあるようなもの。イミディエートに評価し、
高速にレンダリングする。（3Dにおけるシーングラフは宣言型のモデルとは
別種と考える、ということを私は言っているだろうか。）
イベントハンドラの濫用（吹き出しの濫用）による地図学的デザインの
衰退を考えると、操作型が増えることは地図的な世界観には悪いことではない。

最近の WebGL を使う系のライブラリ（Tangram, Mapbox GL, Cesium）は、
そしておそらくそれと共通技術を使っているタイプのモバイル用の
ライブラリは、かなり操作型になっているなあと思う。

ウェブブラウザの実装の都合からか、操作型と宣言型の間には
ギャップがあり、都合の良いところだけ操作型をつまみ食いするというのは
今のところ容易ではない状況になっている。

## pre-rendered
操作型でも宣言型でもないものがあるとすれば、pre-rendered である。
つまり、画像タイルである。

## 蛇足
もちろん、実利用にあたっては混合モードでいくことになる。
混合モードの設計こそが、難しい。だから初心者の講習においては
宣言型と操作型をべつべつに伝える方が良い気がする。

## 操作型と宣言型との対比の中でタイルとは何か
細粒度レンジパーティショニングされたデータストリームである。

タイルはデータストリームであるべきであって、操作型のレンダリングにも
宣言型のレンダリングにも使えることが望ましい。

既存のベクトルタイルのフォーマットは、ほぼストリームとして
解釈できるようになっている。特にMVTはそうであるらしい。
GeoJSONタイルも、全体のコンテナとなる括り（ルート要素）を無視すれば
ストリームとして扱うことができる。Mapzen流のGeoJSONタイルは、
内部でレイヤ分割されたストリームであると解釈することになる。

## まとめ
レンダリングにおいて操作型と宣言型の対比がある。
データであるところのタイルは、操作型にも宣言型にも使えるように
設計されるのが望ましい。操作型と宣言型のいずれでレンダリングするかは、
アプリケーションによる。
